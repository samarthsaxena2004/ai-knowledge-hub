version: '3.8'

services:
  # 1. The Backend (Python + ChromaDB + Gemini)
  backend:
    build: ./backend             # CORRECT: Builds from the /backend folder
    container_name: second_brain_backend
    ports:
      - "8000:8000"
    volumes:
      # REQUIRED: Keep your AI memory safe (Persistence)
      - ./backend/chroma_db:/app/chroma_db
      - ./backend/documents:/app/documents
    environment:
      - GOOGLE_API_KEY=${GOOGLE_API_KEY}

  # 2. The Frontend (Next.js)
  # ... inside the frontend service block
  frontend:
    build: ./frontend
    container_name: second_brain_frontend
    ports:
      - "3000:3000"
    environment:
      # UPDATE THIS LINE:
      - NEXT_PUBLIC_API_URL=http://192.168.1.3:8000
    depends_on:
      - backend